!function(){function e(e,t){return(t||"")+" (SystemJS Error#"+e+" https://git.io/JvFET#"+e+")"}function t(e,t){if(-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/")),"/"===e[0]&&"/"===e[1])return t.slice(0,t.indexOf(":")+1)+e;if("."===e[0]&&("/"===e[1]||"."===e[1]&&("/"===e[2]||2===e.length&&(e+="/"))||1===e.length&&(e+="/"))||"/"===e[0]){var r,n=t.slice(0,t.indexOf(":")+1);if(r="/"===t[n.length+1]?"file:"!==n?(r=t.slice(n.length+2)).slice(r.indexOf("/")+1):t.slice(8):t.slice(n.length+("/"===t[n.length])),"/"===e[0])return t.slice(0,t.length-r.length-1)+e;for(var o=r.slice(0,r.lastIndexOf("/")+1)+e,i=[],a=-1,l=0;o.length>l;l++)-1!==a?"/"===o[l]&&(i.push(o.slice(a,l+1)),a=-1):"."===o[l]?"."!==o[l+1]||"/"!==o[l+2]&&l+2!==o.length?"/"===o[l+1]||l+1===o.length?l+=1:a=l:(i.pop(),l+=2):a=l;return-1!==a&&i.push(o.slice(a)),t.slice(0,t.length-r.length)+i.join("")}}function r(e,r){return t(e,r)||(-1!==e.indexOf(":")?e:t("./"+e,r))}function n(e,r,n,o,i){for(var s in e){var c=t(s,n)||s,u=e[s];if("string"==typeof u){var h=l(o,t(u,n)||u,i);h?r[c]=h:a("W1",s,u,"bare specifier did not resolve")}}}function o(e,t){if(t[e])return e;var r=e.length;do{var n=e.slice(0,r+1);if(n in t)return n}while(-1!==(r=e.lastIndexOf("/",r-1)))}function i(e,t){var r=o(e,t);if(r){var n=t[r];if(null===n)return;if(r.length>=e.length||"/"===n[n.length-1])return n+e.slice(r.length);a("W2",r,n,"should have a trailing '/'")}}function a(t,r,n,o){console.warn(e(t,"Package target "+o+", resolving target '"+n+"' for "+r))}function l(e,t,r){for(var n=e.scopes,a=r&&o(r,n);a;){var l=i(t,n[a]);if(l)return l;a=o(a.slice(0,a.lastIndexOf("/")),n)}return i(t,e.imports)||-1!==t.indexOf(":")&&t}function s(){this[w]={}}function c(e){return e.id}function u(e,t,r,n){if(e.onload(r,t.id,t.d&&t.d.map(c),!!n),r)throw r}function h(t,r,n){var o=t[w][r];if(o)return o;var i=[],a=Object.create(null);N&&Object.defineProperty(a,N,{value:"Module"});var l=Promise.resolve().then(function(){return t.instantiate(r,n)}).then(function(n){if(!n)throw Error(e(2,"Module "+r+" did not instantiate"));var l=n[1](function(e,t){o.h=!0;var r=!1;if("string"==typeof e)e in a&&a[e]===t||(a[e]=t,r=!0);else{for(var n in e)t=e[n],n in a&&a[n]===t||(a[n]=t,r=!0);e.__esModule&&(a.__esModule=e.__esModule)}if(r)for(var l=0;i.length>l;l++){var s=i[l];s&&s(a)}return t},2===n[1].length?{import:function(e){return t.import(e,r)},meta:t.createContext(r)}:void 0);return o.e=l.execute||function(){},[n[0],l.setters||[]]},function(e){throw o.e=null,o.er=e,u(t,o,e,!0),e}),s=l.then(function(e){return Promise.all(e[0].map(function(n,o){var i=e[1][o];return Promise.resolve(t.resolve(n,r)).then(function(e){var n=h(t,e,r);return Promise.resolve(n.I).then(function(){return i&&(n.i.push(i),!n.h&&n.I||i(n.n)),n})})})).then(function(e){o.d=e})});return o=t[w][r]={id:r,i:i,n:a,I:l,L:s,h:!1,d:void 0,e:void 0,er:void 0,E:void 0,C:void 0,p:void 0}}function p(){[].forEach.call(document.querySelectorAll("script"),function(t){if(!t.sp)if("systemjs-module"===t.type){if(t.sp=!0,!t.src)return;System.import("import:"===t.src.slice(0,7)?t.src.slice(7):r(t.src,d)).catch(function(e){if(e.message.indexOf("https://git.io/JvFET#3")>-1){var r=document.createEvent("Event");r.initEvent("error",!1,!1),t.dispatchEvent(r)}return Promise.reject(e)})}else if("systemjs-importmap"===t.type){t.sp=!0;var o=t.src?fetch(t.src,{integrity:t.integrity}).then(function(e){if(!e.ok)throw Error("Invalid status code: "+e.status);return e.text()}).catch(function(r){return r.message=e("W4","Error fetching systemjs-import map "+t.src)+"\n"+r.message,console.warn(r),"{}"}):t.innerHTML;L=L.then(function(){return o}).then(function(o){!function(t,o,i){var a={};try{a=JSON.parse(o)}catch(l){console.warn(Error(e("W5","systemjs-importmap contains invalid JSON")+"\n\n"+o+"\n"))}!function(e,t,o){var i;for(i in e.imports&&n(e.imports,o.imports,t,o,null),e.scopes||{}){var a=r(i,t);n(e.scopes[i],o.scopes[a]||(o.scopes[a]={}),t,o,a)}for(i in e.depcache||{})o.depcache[r(i,t)]=e.depcache[i];for(i in e.integrity||{})o.integrity[r(i,t)]=e.integrity[i]}(a,i,t)}(T,o,t.src||d)})}})}var d,f="undefined"!=typeof Symbol,m="undefined"!=typeof self,g="undefined"!=typeof document,v=m?self:global;if(g){var y=document.querySelector("base[href]");y&&(d=y.href)}if(!d&&"undefined"!=typeof location){var C=(d=location.href.split("#")[0].split("?")[0]).lastIndexOf("/");-1!==C&&(d=d.slice(0,C+1))}var S,N=f&&Symbol.toStringTag,w=f?Symbol():"@",b=s.prototype;b.import=function(e,t){var r=this;return Promise.resolve(r.prepareImport()).then(function(){return r.resolve(e,t)}).then(function(e){var t=h(r,e);return t.C||function(e,t){return t.C=function e(t,r,n,o){if(!o[r.id])return o[r.id]=!0,Promise.resolve(r.L).then(function(){return r.p&&null!==r.p.e||(r.p=n),Promise.all(r.d.map(function(r){return e(t,r,n,o)}))}).catch(function(e){if(r.er)throw e;throw r.e=null,u(t,r,e,!1),e})}(e,t,t,{}).then(function(){return function e(t,r,n){function o(){try{var e=r.e.call(O);if(e)return e=e.then(function(){r.C=r.n,r.E=null,u(t,r,null,!0)},function(e){throw r.er=e,r.E=null,u(t,r,e,!0),e}),r.E=e;r.C=r.n,r.L=r.I=void 0}catch(n){throw r.er=n,n}finally{r.e=null,u(t,r,r.er,!0)}}if(!n[r.id]){if(n[r.id]=!0,!r.e){if(r.er)throw r.er;return r.E?r.E:void 0}var i;return r.d.forEach(function(o){try{var a=e(t,o,n);a&&(i=i||[]).push(a)}catch(l){throw r.e=null,r.er=l,u(t,r,l,!1),l}}),i?Promise.all(i).then(o):o()}}(e,t,{})}).then(function(){return t.n})}(r,t)})},b.createContext=function(e){var t=this;return{url:e,resolve:function(r,n){return Promise.resolve(t.resolve(r,n||e))}}},b.onload=function(){},b.register=function(e,t){S=[e,t]},b.getRegister=function(){var e=S;return S=void 0,e};var O=Object.freeze(Object.create(null));v.System=new s;var E,D,L=Promise.resolve(),T={imports:{},scopes:{},depcache:{},integrity:{}},_=g;if(b.prepareImport=function(e){return(_||e)&&(p(),_=!1),L},g&&(p(),window.addEventListener("DOMContentLoaded",p)),g){window.addEventListener("error",function(e){x=e.filename,R=e.error});var I=location.origin}b.createScript=function(e){var t=document.createElement("script");t.async=!0,e.indexOf(I+"/")&&(t.crossOrigin="anonymous");var r=T.integrity[e];return r&&(t.integrity=r),t.src=e,t};var x,R,M={},P=b.register;b.register=function(e,t){if(g&&"loading"===document.readyState&&"string"!=typeof e){var r=document.querySelectorAll("script[src]"),n=r[r.length-1];if(n){E=e;var o=this;D=setTimeout(function(){M[n.src]=[e,t],o.import(n.src)})}}else E=void 0;return P.call(this,e,t)},b.instantiate=function(t,r){var n=M[t];if(n)return delete M[t],n;var o=this;return new Promise(function(n,i){var a=b.createScript(t);a.addEventListener("error",function(){i(Error(e(3,"Error loading "+t+(r?" from "+r:""))))}),a.addEventListener("load",function(){if(document.head.removeChild(a),x===t)i(R);else{var e=o.getRegister();e&&e[0]===E&&clearTimeout(D),n(e)}}),document.head.appendChild(a)})},b.shouldFetch=function(){return!1},"undefined"!=typeof fetch&&(b.fetch=fetch);var F=b.instantiate,A=/^(text|application)\/(x-)?javascript(;|$)/;b.instantiate=function(t,r){var n=this;return this.shouldFetch(t)?this.fetch(t,{credentials:"same-origin",integrity:T.integrity[t]}).then(function(o){if(!o.ok)throw Error(e(7,o.status+" "+o.statusText+", loading "+t+(r?" from "+r:"")));var i=o.headers.get("content-type");if(!i||!A.test(i))throw Error(e(4,'Unknown Content-Type "'+i+'", loading '+t+(r?" from "+r:"")));return o.text().then(function(e){return 0>e.indexOf("//# sourceURL=")&&(e+="\n//# sourceURL="+t),(0,eval)(e),n.getRegister()})}):F.apply(this,arguments)},b.resolve=function(r,n){return l(T,t(r,n=n||d)||r,n)||function(t,r){throw Error(e(8,"Unable to resolve bare specifier '"+t+(r?"' from "+r:"'")))}(r,n)};var H=b.instantiate;b.instantiate=function(e,t){var r=T.depcache[e];if(r)for(var n=0;r.length>n;n++)h(this,this.resolve(r[n],e),e);return H.call(this,e,t)},m&&"function"==typeof importScripts&&(b.instantiate=function(e){var t=this;return Promise.resolve().then(function(){return importScripts(e),t.getRegister()})}),function(e){function t(t){return!e.hasOwnProperty(t)||!isNaN(t)&&e.length>t||c&&e[t]&&"undefined"!=typeof window&&e[t].parent===window}var r,n,o,i=e.System.constructor.prototype,a=i.import;i.import=function(i,l){return function(){for(var i in r=n=void 0,e)t(i)||(r?n||(n=i):r=i,o=i)}(),a.call(this,i,l)};var l=[[],function(){return{}}],s=i.getRegister;i.getRegister=function(){var i=s.call(this);if(i)return i;var a,c=function(i){var a,l,s=0;for(var c in e)if(!t(c)){if(0===s&&c!==r||1===s&&c!==n)return c;a?(o=c,l=i&&l||c):a=c===o,s++}return l}(this.firstGlobalProp);if(!c)return l;try{a=e[c]}catch(u){return l}return[[],function(e){return{execute:function(){e(a),e({default:a,__useDefault:!0})}}}]};var c="undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Trident")}("undefined"!=typeof self?self:global),function(e){var t=e.System.constructor.prototype,r=/^[^#?]+\.(css|html|json|wasm)([?#].*)?$/;t.shouldFetch=function(e){return r.test(e)};var n=/^application\/json(;|$)/,o=/^text\/css(;|$)/,i=/^application\/wasm(;|$)/,a=t.fetch;t.fetch=function(t,r){return a(t,r).then(function(r){if(!r.ok)return r;var a=r.headers.get("content-type");return n.test(a)?r.json().then(function(e){return new Response(new Blob(['System.register([],function(e){return{execute:function(){e("default",'+JSON.stringify(e)+")}}})"],{type:"application/javascript"}))}):o.test(a)?r.text().then(function(e){return new Response(new Blob(["System.register([],function(e){return{execute:function(){var s=new CSSStyleSheet();s.replaceSync("+JSON.stringify(e)+');e("default",s)}}})'],{type:"application/javascript"}))}):i.test(a)?(WebAssembly.compileStreaming?WebAssembly.compileStreaming(r):r.arrayBuffer().then(WebAssembly.compile)).then(function(r){e.System.wasmModules||(e.System.wasmModules=Object.create(null)),e.System.wasmModules[t]=r;var n=[],o=[];return WebAssembly.Module.imports&&WebAssembly.Module.imports(r).forEach(function(e){var t=JSON.stringify(e.module);-1===n.indexOf(t)&&(n.push(t),o.push("function(m){i["+t+"]=m}"))}),new Response(new Blob(["System.register(["+n.join(",")+"],function(e){var i={};return{setters:["+o.join(",")+"],execute:function(){return WebAssembly.instantiate(System.wasmModules["+JSON.stringify(t)+"],i).then(function(m){e(m.exports)})}}})"],{type:"application/javascript"}))}):r})}}("undefined"!=typeof self?self:global);var k="undefined"!=typeof Symbol&&Symbol.toStringTag;b.get=function(e){var t=this[w][e];if(t&&null===t.e&&!t.E)return t.er?null:t.n},b.set=function(t,r){try{new URL(t)}catch(a){console.warn(Error(e("W3",'"'+t+'" is not a valid URL to set in the module registry')))}var n;k&&"Module"===r[k]?n=r:(n=Object.assign(Object.create(null),r),k&&Object.defineProperty(n,k,{value:"Module"}));var o=Promise.resolve(n),i=this[w][t]||(this[w][t]={id:t,i:[],h:!1,d:[],e:null,er:void 0,E:void 0});return!i.e&&!i.E&&(Object.assign(i,{n:n,I:void 0,L:void 0,C:o}),n)},b.has=function(e){return!!this[w][e]},b.delete=function(e){var t=this[w],r=t[e];if(!r||r.p&&null!==r.p.e||r.E)return!1;var n=r.i;return r.d&&r.d.forEach(function(e){var t=e.i.indexOf(r);-1!==t&&e.i.splice(t,1)}),delete t[e],function(){var r=t[e];if(!r||!n||null!==r.e||r.E)return!1;n.forEach(function(e){r.i.push(e),e(r.n)}),n=null}};var G="undefined"!=typeof Symbol&&Symbol.iterator;b.entries=function(){var e,t,r=this,n=Object.keys(r[w]),o=0,i={next:function(){for(;void 0!==(t=n[o++])&&void 0===(e=r.get(t)););return{done:void 0===t,value:void 0!==t&&[t,e]}}};return i[G]=function(){return this},i}}(),LightPivotTable=function(){var DataController=function(e,t){if(t&&"function"!=typeof t)throw new Error("dataChangeTrigger parameter must be a function");this._dataStack=[],this.controller=e,this.pushData(),this.dataChangeTrigger=t,this.SUMMARY_SHOWN=!1};DataController.prototype.isValidData=function(e){return e.dimensions instanceof Array&&e.dimensions[0]instanceof Array&&!e.dimensions[0].length&&(e.dimensions[0]=[{}]),e.dimensions instanceof Array&&e.dimensions[0]instanceof Array&&e.dataArray instanceof Array&&"object"==typeof e.info&&e.info.cubeName},DataController.prototype.pushData=function(){var e;this._dataStack.push(e={data:null,SUMMARY_SHOWN:this.SUMMARY_SHOWN,SORT_STATE:{column:null,order:-1}}),this.SORT_STATE=e.SORT_STATE},DataController.prototype.popData=function(){if(!(this._dataStack.length<2)){var e=this._dataStack[this._dataStack.length-2];this._dataStack.pop(),this.SUMMARY_SHOWN=e.SUMMARY_SHOWN,this.SORT_STATE=e.SORT_STATE}},DataController.prototype.getData=function(){return this._dataStack[this._dataStack.length-1].data||{}},DataController.prototype.setData=function(e){return this.isValidData(e)?(this._dataStack[this._dataStack.length-1].data=e,this.setLeftHeaderColumnsNumber(e),this.pivotDataProcess(e),this.resetDimensionProps(),this.resetConditionalFormatting(),this.resetRawData(),this.modifyRawData(e),this.postDataProcessing(e),"drillthrough"===e.info.mdxType&&this.setDrillThroughHandler(this.controller.pivotView.listingClickHandler.bind(this.controller.pivotView)),this._trigger(),e):void console.error("Invalid data to set.",e)},DataController.prototype.pivotDataProcess=function(e){var t=this.controller.getPivotProperty(["rowTotals"]);"boolean"==typeof t&&(this.controller.CONFIG.showSummary=t)},DataController.prototype.setDrillThroughHandler=function(e){this._dataStack[this._dataStack.length-1].data.info.drillThroughHandler=e},DataController.prototype.resetDimensionProps=function(){var e,t,r;if(e=this._dataStack[this._dataStack.length-1].data){r=[];var n=function(e){var t,r={};for(t in e)r[t]=e[t];return r},o=function(e,t,r){var i,a,l;if(t.children&&t.children.length>0)for(l in t.children)a=n(r),(i=t.children[l]).format&&(a.format=i.format),i.style&&(a.style=(a.style||"")+i.style),i.summary&&(a.summary=i.summary),i.total&&(a.summary=(i.total||"").toLowerCase().replace(/:.*/,"")),i.type&&(a.type=i.type),o(e,i,a);else e.push(n(r))};o(t=[],{children:e.dimensions[0]},{}),o(r,{children:e.dimensions[1]},{}),e.columnProps=t,e.rowProps=r}else console.error("Unable to get dimension props for given data set.")},DataController.prototype.getTypeByValue=function(e){return isNaN(e)?(e+"").match(/[0-9]{2}\.[0-9]{2}\.[0-9]{2,4}/)?{type:"date",comparator:function(e){var t=e.split(".");return new Date(t[2],t[1],t[0])}}:Date.parse(e)?{type:"date",comparator:function(e){return new Date(e)}}:{type:"string"}:{type:"number"}},DataController.prototype.postDataProcessing=function(e){var t,r;if(e&&e.rawData&&e.rawData[e.info.topHeaderRowsNumber])for(e.columnProps||(e.columnProps=[]),r=e.info.leftHeaderColumnsNumber;t=e.rawData[e.info.topHeaderRowsNumber][r];r++)e.columnProps[r]||(e.columnProps[r]={}),e.columnProps[r].$FORMAT=this.getTypeByValue(t.value)},DataController.prototype.resetConditionalFormatting=function(){var e,t,r,n,o,i,a,l,s={};if(e=this._dataStack[this._dataStack.length-1].data)if(this.controller.CONFIG.pivotProperties){for(var c in(t=this.controller.CONFIG.pivotProperties.colorScale)&&(t.indexOf("custom:")>-1?(o=t.split(":")[1].split(","),n={r:parseInt(o[0]),g:parseInt(o[1]),b:parseInt(o[2])},o=t.split(":")[2].split(","),r={r:parseInt(o[0]),g:parseInt(o[1]),b:parseInt(o[2])}):(o=t.split("-to-"),r=this.controller.pivotView.colorNameToRGB(o[0]),n=this.controller.pivotView.colorNameToRGB(o[1])),s.colorScale={from:n,to:r,min:i=Math.min.apply(Math,e.dataArray||[]),max:a=Math.max.apply(Math,e.dataArray||[]),diff:a-i,invert:(n.r+n.b+n.g)/3<128}),(l=this.controller.CONFIG.pivotProperties.formatRules||[]).length&&void 0===this.controller.CONFIG.conditionalFormattingOn&&(this.controller.CONFIG.conditionalFormattingOn=!0),l)s[l[c].range]||(s[l[c].range]=[]),s[l[c].range].push(l[c]);e.conditionalFormatting=s}else e.conditionalFormatting=s;else console.error("Unable to get conditional formatting for given data set.")},DataController.prototype.TOTAL_FUNCTIONS={isNumber:function(e){return""!=e&&isFinite(e)},totalSUM:function(e,t,r,n,o,i){for(var a=0,l=t;l<r;l++){var s=void 0===i?l:i,c=void 0===n?l:n;this.isNumber(e[s][c].value)&&(a+=parseFloat(e[s][c].value)||0)}return a},totalAVG:function(e,t,r,n,o,i){for(var a=0,l=t;l<r;l++){var s=void 0===i?l:i,c=void 0===n?l:n;if(!this.isNumber(e[s][c].value)){a=0;break}a+=parseFloat(e[s][c].value)||0}return a/(r-t)||""},totalCOUNT:function(e,t,r,n,o,i){for(var a=0,l=t;l<r;l++){var s=void 0===n?l:n;e[void 0===i?l:i][s].value&&a++}return a},totalMIN:function(e,t,r,n,o,i){for(var a=1/0,l=t;l<r;l++){var s=void 0===i?l:i,c=void 0===n?l:n;this.isNumber(e[s][c].value)&&e[s][c].value<a&&(a=e[s][c].value)}return a},totalMAX:function(e,t,r,n,o,i){for(var a=-1/0,l=t;l<r;l++){var s=void 0===i?l:i,c=void 0===n?l:n;this.isNumber(e[s][c].value)&&e[s][c].value>a&&(a=e[s][c].value)}return a},totalPERCENTAGE:function(e,t,r,n,o,i){var a,l,s=[];for(a=o;a<typeof n==="undefined"?e.length:e[0].length;a++)s.push(this.totalSUM(e,t,r,void 0===n?n:a,o,void 0===i?i:a));return l=s.reduce(function(e,t){return e+t}),(s[(void 0===i?n:i)-o]/l*100||0).toFixed(2)+"%"},totalNONE:function(){return""}},DataController.prototype.setLeftHeaderColumnsNumber=function(e){e.info.leftHeaderColumnsNumber=function e(t,r){if(!(t.children instanceof Array))return r;for(var n=r+1,o=0;o<t.children.length;o++)r=Math.max(e(t.children[o],n),r);return r}({children:e.dimensions[1]||[]},0)},DataController.prototype.resetRawData=function(){var e,t,r,n,o,i="font-weight: bold;text-align: right;",a=this;if(!(e=this._dataStack[this._dataStack.length-1].data))return console.error("Unable to create raw data for given data set."),null;var l=[],s=[],c=2,u=[],h=a.controller.CONFIG.pivotProperties&&2===a.controller.CONFIG.pivotProperties.hideMeasures,p=function(e,t){a.controller.CONFIG.pivotProperties&&(a.controller.CONFIG.pivotProperties.columnHeaderStyle&&t?e.style=a.controller.CONFIG.pivotProperties.columnHeaderStyle:a.controller.CONFIG.pivotProperties.rowHeaderStyle&&!t&&(e.style=a.controller.CONFIG.pivotProperties.rowHeaderStyle))},d=function(e,t,r,n,o,i){var a,l,s;for(var u in r||(r=[]),t)a=c,!(o<i)||t[u].children&&t[u].children.length||(t[u].children=[{}],s=!0),t[u].children&&t[u].children.length?(s?s=!1:c++,l={group:a,source:t[u],isCaption:!0,value:t[u].caption||""},p(l,n),d(e,t[u].children,r.concat(l),n,o?o+1:o,i)):(l={group:c,source:t[u],isCaption:!0,value:t[u].caption||""},p(l,n),e.push("msr"===t[u].type&&h?r:r.concat(l)),c++)};e.dimensions[0].length&&function(e,t,r){d(l,t,r,!0);var n,o=0;for(n in l)l[n].length>o&&(o=l[n].length);for(n in l)for(var i=l[n].length;i<o;i++)l[n].push(l[n][l[n].length-1]);l=function(e){return Object.keys(e[0]).map(function(t){return e.map(function(e){return e[t]})})}(l)}(0,e.dimensions[0]),e.dimensions[1].length&&d(s,e.dimensions[1],void 0,void 0,1,function(e,t){function r(e,t){if(e.children){var n=0;for(var o in e.children)n=Math.max(n,r(e.children[o],t+1));return n}return"msr"===e.type&&h?t-1:t}return void 0===t&&(t=0),e.reduce(function(e,t){return Math.max(e,r(t,1))},t)}(e.dimensions[1])),s[0]&&(o=(s[0][s[0].length-1]||{source:{}}).source.dimension);var f=(l[0]||[]).length,m=s.length||e.info.rowCount||0,g=l.length||e.info.colCount||0,v=(s[0]||[]).length,y=!!this.controller.CONFIG.attachTotals;for(r=0;r<g+m;r++)for(u[r]||(u[r]=[]),n=0;n<v+f;n++)n<v?r<g?(u[r][n]={group:1,isCaption:!0,value:!1===this.controller.getPivotProperty(["showRowCaption"])?"":this.controller.CONFIG.caption||o||(e.info||{}).cubeName||""},p(u[r][n],!1)):u[r][n]=s[r-g][n]:u[r][n]=r<g?l[r][n-v]:{value:e.dataArray[f*(r-g)+n-v]};for(e.info.topHeaderRowsNumber=g,e.info.SUMMARY_SHOWN=!1,e.info.leftHeaderColumnsNumber=v,this.SUMMARY_SHOWN=!1,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!1,S=0;S<e.info.leftHeaderColumnsNumber;S++)e.columnProps.unshift({});for(S=0;S<e.info.topHeaderRowsNumber;S++)e.rowProps.unshift({});var C=function(t,r){var n=a.controller.getPivotProperty(["rowTotalAgg"])||"sum",o=a.controller.getPivotProperty(["columnTotalAgg"])||"sum",i=r?"rowProps":"columnProps";if(!e[i][t]&&!(r?o:n))return a.TOTAL_FUNCTIONS.totalSUM;switch((e[i][t]||{}).summary||n){case"count":return a.TOTAL_FUNCTIONS.totalSUM;case"avg":return a.TOTAL_FUNCTIONS.totalAVG;case"min":return a.TOTAL_FUNCTIONS.totalMIN;case"max":return a.TOTAL_FUNCTIONS.totalMAX;case"pct":return a.TOTAL_FUNCTIONS.totalPERCENTAGE;case"none":return a.TOTAL_FUNCTIONS.totalNONE;default:return a.TOTAL_FUNCTIONS.totalSUM}};if(this.controller.CONFIG.showSummary&&u.length-e.info.topHeaderRowsNumber>1&&(u[u.length-1][0]||{}).isCaption){for(var S in e.info.SUMMARY_SHOWN=!0,this.SUMMARY_SHOWN=!0,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!0,t=[],u[n=u.length-2])u[n][S].isCaption?(t[S]={group:c,isCaption:!0,source:{},noDrillDown:!0,value:pivotLocale.get(0)},p(t[S],!1)):t[S]={value:C(parseInt(S)).call(this.TOTAL_FUNCTIONS,u,g,u.length,S,e.info.leftHeaderColumnsNumber),style:i};c++,y?(u.splice(e.info.topHeaderRowsNumber,0,t),e.info.topHeaderRowsNumber++):u.push(t)}if(this.controller.getPivotProperty(["columnTotals"])&&u.length-e.info.topHeaderRowsNumber>1&&e.info.leftHeaderColumnsNumber>0){var N,w=++c;for(N=0;N<e.info.topHeaderRowsNumber;N++)u[N].push({group:w,isCaption:!0,value:pivotLocale.get(0)});for(N=e.info.topHeaderRowsNumber;N<u.length;N++)u[N].push({isCaption:!0,value:C(N,!0).call(this.TOTAL_FUNCTIONS,u,e.info.leftHeaderColumnsNumber,u[N].length,void 0,e.info.leftHeaderColumnsNumber,N),style:i})}return u=function(t){if(!a.controller.CONFIG.pivotProperties)return t;var r,n,o,i=t[0].length,l=a.controller.getPivotProperty(["columnLevels"]),s=a.controller.getPivotProperty(["rowLevels"]),c={},u={},h=function(e,t){if(void 0!==t)for(var r in t.childLevels)t.childLevels[r]&&t.childLevels[r].spec&&(e[(t.childLevels[r].spec||"").replace(/[^.]*$/,"")]={style:t.childLevels[r].levelStyle||"",headStyle:t.childLevels[r].levelHeaderStyle||""}),h(t.childLevels[r])};for(o in l)h(c,{childLevels:[l[o]]}),h(u,{childLevels:[s[o]]});for(n=0;n<t.length;n++)for(r=0;r<i;r++){if(!t[n][r].isCaption){i=r;break}if(t[n][r].source&&t[n][r].source.path){var p=e.info.topHeaderRowsNumber>n?c:u;for(o in p)if(t[n][r].source.path.indexOf(o)>=0){t[n][r].isCaption?p[o].headStyle&&(t[n][r].style=(t[n][r].style||"")+p[o].headStyle||""):p[o].style&&(t[n][r].style=(t[n][r].style||"")+p[o].style||"");break}}}return t}(u),e.rawData=e._rawDataOrigin=u,e.rawData},DataController.prototype._trigger=function(){this.dataChangeTrigger&&this.dataChangeTrigger()},DataController.prototype.sortByColumn=function(e){var t,r=this._dataStack[this._dataStack.length-1].data,n=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0;this.SORT_STATE.column!==e&&(a=this.SORT_STATE.order=0);var o=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!n?1:0)),i=r.info.leftHeaderColumnsNumber+e,a=-1===this.SORT_STATE.order?1:1===this.SORT_STATE.order?0:-1;for(var l in this.SORT_STATE.order=a,this.SORT_STATE.column=e,r.rawData[r.info.topHeaderRowsNumber-n-1])r.rawData[r.info.topHeaderRowsNumber-n-1][l].className&&delete r.rawData[r.info.topHeaderRowsNumber-n-1][l].className;return 0===a?(r.rawData=r._rawDataOrigin,this.modifyRawData(r),void this._trigger()):(a=-a,"function"==typeof(t=((r.columnProps[e]||{}).$FORMAT||{}).comparator)?o.sort(function(e,r){return t(r[i].value)>t(e[i].value)?a:t(r[i].value)<t(e[i].value)?-a:0}):o.sort(function(e,t){return t[i].value>e[i].value?a:t[i].value<e[i].value?-a:0}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(o).concat(this.SUMMARY_SHOWN&&!n?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),r.rawData[r.info.topHeaderRowsNumber-n-1][r.info.leftHeaderColumnsNumber+e].className=0===a?"":1===a?"lpt-sortDesc":"lpt-sortAsc",this.modifyRawData(r),void this._trigger())},DataController.prototype.filterByValue=function(e,t){var r=this._dataStack[this._dataStack.length-1].data,n=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,o=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!n?1:0)),i=null;try{i=new RegExp(e,"i")}catch(a){try{i=new RegExp(e.replace(/([()[{*+.$^\\|?])/g,"\\$1"),"i")}catch(a){return}}o=o.filter(function(e){return(e[t].value||"").toString().match(i)}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(o).concat(this.SUMMARY_SHOWN&&!n?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),this.modifyRawData(r),this._trigger()},DataController.prototype.modifyRawData=function(e){var t=-1;this.controller.CONFIG.showRowNumbers&&!e.info.leftHeaderColumnsNumber&&(e.rawData[0]&&e.rawData[0][0].special?e.rawData.forEach(function(e){e[0].value=0==++t?"#":t,e[0].isCaption=0===t}):(e.rawData.forEach(function(e){e.unshift({value:0==++t?"#":t,isCaption:0===t,special:!0,noClick:!0})}),e.columnProps instanceof Array&&e.columnProps.unshift({}),e.info.colCount++));var r=e.info.topHeaderRowsNumber-1;for(t=e.info.leftHeaderColumnsNumber;t<e.rawData[r].length;t++)e.rawData[r][t].style="min-width:"+(this.controller.getPivotProperty(["cellWidth"])||100)+"px;"+(e.rawData[r][t].style?e.rawData[r][t].style:"")};var DataSource=function(e,t,r,n){this.SOURCE_URL=e.MDX2JSONSource||location.host+":"+location.port+"/"+(location.pathname.split("/")||[])[1],this.NAMESPACE=e.namespace,this.USERNAME=e.username,this.PASSWORD=e.password,this.LPT=r,this.GLOBAL_CONFIG=t,this.SEND_COOKIES=e.sendCookies||!1,this.DRILL_LEVEL="number"!=typeof n?1:n,this.BASIC_MDX=e.basicMDX,this.DATA_SOURCE_PIVOT=e.pivot||"",this.FILTERS=[]};DataSource.prototype._post=function(url,data,callback){var xhr=new XMLHttpRequest,self=this;xhr.open("POST",url),this.SEND_COOKIES&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){var handler;4===xhr.readyState&&(handler=self.LPT.CONFIG.triggers.responseHandler,"function"==typeof handler&&handler.call(self.LPT,{url:url,status:xhr.status,xhr:xhr})),4===xhr.readyState&&200===xhr.status?callback(function(){try{return JSON.parse(xhr.responseText)||{}}catch(e){try{var temp=null;return eval("temp="+xhr.responseText),temp}catch(e){return{error:"<h1>Unable to parse server response</h1><p>"+xhr.responseText+"</p>"}}}}()):4===xhr.readyState&&200!==xhr.status&&callback({error:xhr.responseText||pivotLocale.get(3)+"<br/>"+xhr.status+": "+xhr.statusText})},this.USERNAME&&this.PASSWORD&&xhr.setRequestHeader("Authorization","Basic "+btoa(this.USERNAME+":"+this.PASSWORD)),xhr.send(JSON.stringify(data))},DataSource.prototype._convert=function(e){if("object"!=typeof e||e.error)return{error:e.error||!0};try{return{dimensions:[e.Cols[0].tuples,e.Cols[1].tuples],dataArray:e.Data,info:e.Info}}catch(r){return console.error("Error while parsing data:",r),{error:e.error||!0}}},DataSource.prototype.setFilter=function(e){this.FILTERS.push(e)},DataSource.prototype.clearFilters=function(){this.FILTERS=[]},DataSource.prototype.getCurrentData=function(e){for(var t=this,r=this._convert,n=this.BASIC_MDX,o=new MDXParser,i=o.mdxType(n),a={state:0,data:{},pivotData:{}},l=0;l<this.FILTERS.length;l++)n=o.applyFilter(n,this.FILTERS[l]);"number"==typeof this.GLOBAL_CONFIG.rowCount&&(n=o.applyRowCount(n,this.GLOBAL_CONFIG.rowCount));var s=function(){var o=a.data;if("drillthrough"===i)e(function(e){var t,n,o,a=e.children||[],l=[];if(!a.length)return{error:pivotLocale.get(4)};for(n in a[0])l.push({caption:n});for(n in t={Cols:[{tuples:l},{tuples:[]}],Data:[],Info:{colCount:8,cubeClass:"No cube class",cubeName:"No cube name",leftHeaderColumnsNumber:0,rowCount:a.length,topHeaderRowsNumber:l.length,mdxType:i}},a)for(o in a[n])t.Data.push(a[n][o]);return r(t)}(o));else if("mdx"===i){if(!(o&&o.Data&&o.Data.length&&o.Cols&&(o.Data.length||((o.Cols[0]||{}).tuples||[]).length||((o.Cols[1]||{}).tuples||[]).length)))return e({error:pivotLocale.get(4)});e(t._convert(o))}else e({error:"Unrecognised MDX type: "+n||!0})},c=function(){t.LPT.CONFIG.logs&&console.log("LPT MDX request:",n);var e=function(e){t.LPT.pivotView.removeMessage(),a.data=e,a.state++,s()};return 0===t.DRILL_LEVEL&&t.LPT.CONFIG.initialData?void e(t.LPT.CONFIG.initialData):void t._post(t.SOURCE_URL+"/"+("drillthrough"===i?"MDXDrillthrough":"MDX")+(t.NAMESPACE?"?Namespace="+t.NAMESPACE:""),{MDX:n},e)};t.LPT.pivotView.displayLoading(),this.DATA_SOURCE_PIVOT?this._post(this.SOURCE_URL+"/DataSource"+(t.NAMESPACE?"?Namespace="+t.NAMESPACE:""),{DataSource:this.DATA_SOURCE_PIVOT},function(e){a.pivotData=e,a.state++,function(){var e=a.pivotData;t.GLOBAL_CONFIG.pivotProperties=a.pivotData,e.rowAxisOptions&&(e.rowAxisOptions.drilldownSpec&&(t.GLOBAL_CONFIG.DrillDownExpression=t.GLOBAL_CONFIG.DrillDownExpression||e.rowAxisOptions.drilldownSpec.split("^")),(e.rowAxisOptions.levelFormat||e.columnAxisOptions&&e.columnAxisOptions.levelFormat)&&(t.GLOBAL_CONFIG.formatNumbers=t.GLOBAL_CONFIG.formatNumbers||e.columnAxisOptions.levelFormat||e.rowAxisOptions.levelFormat))}(),c()}):(t.GLOBAL_CONFIG.pivotProperties={},c())};var ExcelExport=function(){},e,t,r,o;ExcelExport.prototype.exportTableHTML=(e="data:application/vnd.ms-excel;base64,",t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>',r=function(e){return window.btoa(unescape(encodeURIComponent(e)))},o=function(e,t){return e.replace(/{(\w+)}/g,function(e,r){return t[r]})},function(n,i){var a={worksheet:i||"Worksheet",table:n};console.log(e+r(o(t,a))),window.location.href=e+r(o(t,a))}),ExcelExport.prototype.exportXLS=function(){var e=document.getElementsByClassName("lpt")[0],t=e.getElementsByClassName("lpt-tableBlock")[0].getElementsByTagName("table")[0].innerHTML,r=e.getElementsByClassName("lpt-topHeader")[0].getElementsByTagName("table")[0].innerHTML.replace(/<tr>/,"<tr><th colspan='2'></th>"),n=e.getElementsByClassName("lpt-leftHeader")[0].getElementsByTagName("thead")[0].innerHTML.match("<tr>(.*)</tr>")[1].split("</tr><tr>"),o=0;t=t.replace(/<tr>/g,function(){return"<tr>"+n[o++]}),console.log(r+t),this.exportTableHTML(r+t,"test")};var LightPivotTable=function(e){var t=this;"object"!=typeof e&&(e={}),this.normalizeConfiguration(e),this._dataSourcesStack=[],this.DRILL_LEVEL=-1,this.CONFIG=e,this.VERSION="".concat("1.8.14")||"[NotBuilt]",this.CONTROLS={},this.mdxParser=new MDXParser,this.pivotView=new PivotView(this,e.container),this.dataSource=this.pushDataSource(e.dataSource),this.dataController=new DataController(this,function(){t.dataIsChanged.call(t)}),this.init()};LightPivotTable.prototype.refresh=function(){var e,t=this;if(this.dataSource.BASIC_MDX){if(this.clearFilters(),this.CONFIG.defaultFilterSpecs instanceof Array)for(e in this.CONFIG.defaultFilterSpecs)this.setFilter(this.CONFIG.defaultFilterSpecs[e]);this.dataSource.getCurrentData(function(e){t.dataController.isValidData(e)?t.dataController.setData(e):t.pivotView.displayMessage(e.error||pivotLocale.get(2))})}else console.log("Unable to refresh: no basic MDX set.")},LightPivotTable.prototype.changeBasicMDX=function(e){for(var t=this._dataSourcesStack.length-1;t>0;t--)this.popDataSource(),this.pivotView.popTable(),this.dataController.popData();this.CONFIG.dataSource.basicMDX=e,this.dataSource.BASIC_MDX=e,this.refresh()},LightPivotTable.prototype.setRowCount=function(e){this.CONFIG.rowCount=e},LightPivotTable.prototype.getActualMDX=function(){var e=this.dataSource.BASIC_MDX,t=new MDXParser,r=this.dataSource.FILTERS;for(var n in r)e=t.applyFilter(e,r[n]);return"number"==typeof this.CONFIG.rowCount&&(e=t.applyRowCount(e,this.CONFIG.rowCount)),e},LightPivotTable.prototype.isListing=function(){return 0===(this.dataController.getData().info||{}).leftHeaderColumnsNumber},LightPivotTable.prototype.getSelectedRows=function(){var e,t=[],r=this.pivotView.selectedRows;for(e in r)r[e]&&t.push(+e);return t},LightPivotTable.prototype.getRowsValues=function(e){if(void 0===e)return[];if(e instanceof Array||(e=[e]),0===e.length)return[];for(var t=this.dataController.getData(),r=[],n=0;n<e.length;n++)r.push(t.rawData[e[n]-1+(t.info.topHeaderRowsNumber||1)]);return r},LightPivotTable.prototype.getModel=function(){return this.dataController.getData()},LightPivotTable.prototype.updateSizes=function(){this.pivotView.updateSizes()},LightPivotTable.prototype.setFilter=function(e){this.dataSource.setFilter(e)},LightPivotTable.prototype.clearFilters=function(){this.dataSource.clearFilters()},LightPivotTable.prototype.pushDataSource=function(e){var t;return this.DRILL_LEVEL++,this._dataSourcesStack.push(t=new DataSource(e||{},this.CONFIG,this,this.DRILL_LEVEL)),this.dataSource=t,t},LightPivotTable.prototype.popDataSource=function(e){this._dataSourcesStack.length<2||(this.DRILL_LEVEL--,this._dataSourcesStack.pop(),e||this.dataController.popData(),this.dataSource=this._dataSourcesStack[this._dataSourcesStack.length-1])},LightPivotTable.prototype.dataIsChanged=function(){this.pivotView.dataChanged(this.dataController.getData())},LightPivotTable.prototype.tryDrillDown=function(e){var t,r=this,n={};for(var o in r.CONFIG.dataSource)n[o]=r.CONFIG.dataSource[o];!this.CONFIG.DrillDownExpression||this.CONFIG.DrillDownExpression instanceof Array||(this.CONFIG.DrillDownExpression=[this.CONFIG.DrillDownExpression]),(this.CONFIG.DrillDownExpression||[])[this.DRILL_LEVEL]?n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,e,this.CONFIG.DrillDownExpression[this.DRILL_LEVEL])||this.dataSource.BASIC_MDX:n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,e)||this.dataSource.BASIC_MDX,t=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=t.FILTERS,this.dataSource.getCurrentData(function(e){r.dataController.isValidData(e)&&e.dataArray.length>0&&e.dimensions[1]&&e.dimensions[1][0]&&(e.dimensions[1][0].caption||e.dimensions[1][0].dimension||e.dimensions[1][0].path)?(r.pivotView.pushTable(),r.dataController.pushData(),r.dataController.setData(e),"function"==typeof r.CONFIG.triggers.drillDown&&r.CONFIG.triggers.drillDown.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX,path:e.dimensions[1][0].path||""})):r.popDataSource(!0)})},LightPivotTable.prototype.tryDrillThrough=function(e){var t,r=this,n={};for(var o in r.CONFIG.dataSource)n[o]=r.CONFIG.dataSource[o];n.basicMDX=this.mdxParser.drillThrough(this.dataSource.BASIC_MDX,e)||this.dataSource.basicMDX,t=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=t.FILTERS,this.dataSource.getCurrentData(function(e){r.dataController.isValidData(e)&&e.dataArray.length>0?(r.pivotView.pushTable({disableConditionalFormatting:!0}),r.dataController.pushData(),r.dataController.setData(e),"function"==typeof r.CONFIG.triggers.drillThrough&&r.CONFIG.triggers.drillThrough.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX})):r.popDataSource(!0)})},LightPivotTable.prototype.getPivotProperty=function(e){if(this.CONFIG.pivotProperties){e instanceof Array||(e=[]);var t=this.CONFIG.pivotProperties;for(e=e.reverse();e.length&&void 0!==t;)t=t[e.pop()];return t}},LightPivotTable.prototype.attachTrigger=function(e,t){return"function"!=typeof t?void console.warn("LPT.addTrigger: pass the trigger as a second argument."):void(this.CONFIG.triggers[e]=t)},LightPivotTable.prototype.normalizeConfiguration=function(e){void 0===e.columnResizing&&(e.columnResizing=!0),void 0===e.pagination&&(e.pagination=200),void 0===e.enableSearch&&(e.enableSearch=!0),void 0===e.stretchColumns&&(e.stretchColumns=!0),void 0===e.enableListingSelect&&(e.enableListingSelect=!0),void 0===e.showListingRowsNumber&&(e.showListingRowsNumber=!0),e.triggers||(e.triggers={}),e.dataSource||(e.dataSource={})},LightPivotTable.prototype.init=function(){var e=this;this.CONTROLS.drillThrough=function(){e.pivotView._drillThroughClickHandler.call(e.pivotView)},this.CONTROLS.customDrillThrough=function(t){return t instanceof Array?void e.tryDrillThrough.call(e,t):void console.error('Parameter "filters" must be array of strings.')},this.CONTROLS.back=function(){e.pivotView._backClickHandler.call(e.pivotView)},this.CONFIG.locale&&pivotLocale.setLocale(this.CONFIG.locale),this.refresh()};var MDXParser=function(){};MDXParser.prototype._warnMDX=function(e,t){console.warn("MDX is not parsed:\n\n%s\n\n"+(t?"("+t+")":""),e)},MDXParser.prototype.makeSetExpressionFromFilter=function(e){return e.match(/^\([^\),]*,[^\)]*\)$/)?"NONEMPTYCROSSJOIN"+e.slice(0,e.length-1)+".children)":e+".children"},MDXParser.prototype.prependNonEmpty=function(e){return e.match(/^\s*non\s+empty/i)?e:"NON EMPTY "+e},MDXParser.prototype.applyRowCount=function(e,t){return e.replace(/\s*on\s*0\s*,\s*(?:non\s*empty\s*)?(.*)\s*on\s*1/i,function(e,r){return void 0!==t?" ON 0, NON EMPTY HEAD("+r+", "+t+") ON 1":e})},MDXParser.prototype.drillDown=function(e,t,r){if(!t)return/]\s+ON\s+1/i.test(e)?e=e.replace(/]\s+ON\s+1/i,"].children ON 1"):(this._warnMDX(e,"no filter specified"),"");var n=e.split(/(select\s*)(.*?)(\s*from)/gi);if(n.length<4)return this._warnMDX(e),"";var o=n[n.length-3].split(/(\s*ON\s*[01]\s*,?\s*)/i);if(o.length<2)return this._warnMDX(e,"DrillDown is impossible"),"";var i=-1;if(o.map(function(e,t){return e.match(/\s*ON\s*[01]\s*,?\s*/i)&&(i=t-1),e}),-1===i)return this._warnMDX(e,"DrillDown is impossible"),"";for(var a in o[i]=this.prependNonEmpty(r||this.makeSetExpressionFromFilter(t)),o)1===o[a].length&&o[a](parseInt(a),1);return n[n.length-3]=o.join(""),this.applyFilter(n.join(""),t)},MDXParser.prototype.drillThrough=function(e,t){var r="DRILLTHROUGH SELECT "+e.slice(e.lastIndexOf("FROM "));for(var n in t)r=this.applyFilter(r,t[n]);return r},MDXParser.prototype.mdxType=function(e){var t=e.toLowerCase(),r=t.indexOf("drillthrough"),n=t.indexOf("select");return r>-1?"drillthrough":n>-1?"mdx":"unknown"},MDXParser.prototype.applyFilter=function(e,t){return e+(t?" %FILTER "+t:"")};var numeral=function(){function e(e){this._value=e}function t(e,t,r,n){var o,i,a=Math.pow(10,t);return i=(r(e*a)/a).toFixed(t),n&&(o=new RegExp("0{1,"+n+"}$"),i=i.replace(o,"")),i}function r(e,t,r){return t.indexOf("$")>-1?function(e,t,r){var n,i,a=t.indexOf("$"),l=t.indexOf("("),u=t.indexOf("-"),h="";return t.indexOf(" $")>-1?(h=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(h=" ",t=t.replace("$ ","")):t=t.replace("$",""),i=o(e._value,t,r),a<=1?i.indexOf("(")>-1||i.indexOf("-")>-1?(i=i.split(""),n=1,(a<l||a<u)&&(n=0),i.splice(n,0,s[c].currency.symbol+h),i=i.join("")):i=s[c].currency.symbol+h+i:i.indexOf(")")>-1?((i=i.split("")).splice(-1,0,h+s[c].currency.symbol),i=i.join("")):i=i+h+s[c].currency.symbol,i}(e,t,r):t.indexOf("%")>-1?function(e,t,r){var n,i="",a=100*e._value;return t.indexOf(" %")>-1?(i=" ",t=t.replace(" %","")):t=t.replace("%",""),(n=o(a,t,r)).indexOf(")")>-1?((n=n.split("")).splice(-1,0,i+"%"),n=n.join("")):n=n+i+"%",n}(e,t,r):t.indexOf(":")>-1?function(e){var t=Math.floor(e._value/60/60),r=Math.floor((e._value-60*t*60)/60),n=Math.round(e._value-60*t*60-60*r);return t+":"+(r<10?"0"+r:r)+":"+(n<10?"0"+n:n)}(e):o(e._value,t,r)}function n(e,t){var r,n,o,i,a,l=t,h=["KB","MB","GB","TB","PB","EB","ZB","YB"],p=!1;if(t.indexOf(":")>-1)e._value=function(e){var t=e.split(":"),r=0;return 3===t.length?(r+=60*Number(t[0])*60,r+=60*Number(t[1]),r+=Number(t[2])):2===t.length&&(r+=60*Number(t[0]),r+=Number(t[1])),Number(r)}(t);else if(t===u)e._value=0;else{for("."!==s[c].delimiters.decimal&&(t=t.replace(/\./g,"").replace(s[c].delimiters.decimal,".")),r=new RegExp("[^a-zA-Z]"+s[c].abbreviations.thousand+"(?:\\)|(\\"+s[c].currency.symbol+")?(?:\\))?)?$"),n=new RegExp("[^a-zA-Z]"+s[c].abbreviations.million+"(?:\\)|(\\"+s[c].currency.symbol+")?(?:\\))?)?$"),o=new RegExp("[^a-zA-Z]"+s[c].abbreviations.billion+"(?:\\)|(\\"+s[c].currency.symbol+")?(?:\\))?)?$"),i=new RegExp("[^a-zA-Z]"+s[c].abbreviations.trillion+"(?:\\)|(\\"+s[c].currency.symbol+")?(?:\\))?)?$"),a=0;a<=h.length&&!(p=t.indexOf(h[a])>-1&&Math.pow(1024,a+1));a++);e._value=(p||1)*(l.match(r)?Math.pow(10,3):1)*(l.match(n)?Math.pow(10,6):1)*(l.match(o)?Math.pow(10,9):1)*(l.match(i)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,"")),e._value=p?Math.ceil(e._value):e._value}return e._value}function o(e,r,n){var o,i,a,l,h,p,g=!1,v=!1,y=!1,C="",S=!1,N=!1,w=!1,b=!1,O=!1,E="",D="",L=Math.abs(e),T=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],_="",I=!1;if(0===e&&null!==u)return u;if(r.indexOf("(")>-1?(g=!0,r=r.slice(1,-1)):r.indexOf("+")>-1&&(v=!0,r=r.replace(/\+/g,"")),r.indexOf("a")>-1&&(S=r.indexOf("aK")>=0,N=r.indexOf("aM")>=0,w=r.indexOf("aB")>=0,b=r.indexOf("aT")>=0,O=S||N||w||b,r.indexOf(" a")>-1?(C=" ",r=r.replace(" a","")):r=r.replace("a",""),L>=Math.pow(10,12)&&!O||b?(C+=s[c].abbreviations.trillion,e/=Math.pow(10,12)):L<Math.pow(10,12)&&L>=Math.pow(10,9)&&!O||w?(C+=s[c].abbreviations.billion,e/=Math.pow(10,9)):L<Math.pow(10,9)&&L>=Math.pow(10,6)&&!O||N?(C+=s[c].abbreviations.million,e/=Math.pow(10,6)):(L<Math.pow(10,6)&&L>=Math.pow(10,3)&&!O||S)&&(C+=s[c].abbreviations.thousand,e/=Math.pow(10,3))),r.indexOf("b")>-1)for(r.indexOf(" b")>-1?(E=" ",r=r.replace(" b","")):r=r.replace("b",""),a=0;a<=T.length;a++)if(o=Math.pow(1024,a),i=Math.pow(1024,a+1),e>=o&&e<i){E+=T[a],o>0&&(e/=o);break}return r.indexOf("o")>-1&&(r.indexOf(" o")>-1?(D=" ",r=r.replace(" o","")):r=r.replace("o",""),D+=s[c].ordinal(e)),r.indexOf("[.]")>-1&&(y=!0,r=r.replace("[.]",".")),l=e.toString().split(".")[0],h=r.split(".")[1],p=r.indexOf(","),h?(h.indexOf("[")>-1?_=t(e,(h=(h=h.replace("]","")).split("["))[0].length+h[1].length,n,h[1].length):_=t(e,h.length,n),l=_.split(".")[0],_=_.split(".")[1].length?(f||s[c].delimiters.decimal)+_.split(".")[1]:"",y&&0===Number(_.slice(1))&&(_="")):l=t(e,null,n),l.indexOf("-")>-1&&(l=l.slice(1),I=!0),p>-1&&(l=l.toString().replace(m,"$1"+(d||s[c].delimiters.thousands))),0===r.indexOf(".")&&(l=""),(g&&I?"(":"")+(!g&&I?"-":"")+(!I&&v?"+":"")+l+_+(D||"")+(C||"")+(E||"")+(g&&I?")":"")}function i(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function a(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var r=i(e),n=i(t);return r>n?r:n},-1/0)}var l,s={},c="en",u=null,h="0,0",p=3,d=",",f=".",m=new RegExp("(\\d)(?=(\\d{"+p+"})+(?!\\d))","g");(l=function(t){return l.isNumeral(t)?t=t.value():0===t||void 0===t?t=0:Number(t)||(t=l.fn.unformat(t)),new e(Number(t))}).version="1.5.3",l.isNumeral=function(t){return t instanceof e},l.language=function(e,t){if(!e)return c;if(e&&!t){if(!s[e])throw new Error("Unknown language : "+e);c=e}return!t&&s[e]||function(e,t){s[e]=t}(e,t),l},l.languageData=function(e){if(!e)return s[c];if(!s[e])throw new Error("Unknown language : "+e);return s[e]},l.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"$"}}),l.zeroFormat=function(e){u="string"==typeof e?e:null},l.defaultFormat=function(e){h="string"==typeof e?e:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){"use strict";if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var r,n,o=this.length>>>0,i=!1;for(1<arguments.length&&(n=t,i=!0),r=0;o>r;++r)this.hasOwnProperty(r)&&(i?n=e(n,this[r],r,this):(n=this[r],i=!0));if(!i)throw new TypeError("Reduce of empty array with no initial value");return n}),l.setup=function(e,t,r){e!==f&&(f=e),t!==d&&(d=t),r!==p&&(p=r,m=new RegExp("(\\d)(?=(\\d{"+p+"})+(?!\\d))","g"))},l.fn=e.prototype={clone:function(){return l(this)},format:function(e,t){return r(this,e||h,void 0!==t?t:Math.round)},unformat:function(e){return"[object Number]"===Object.prototype.toString.call(e)?e:n(this,e||h)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){var t=a.call(null,this._value,e);return this._value=[this._value,e].reduce(function(e,r,n,o){return e+t*r},0)/t,this},subtract:function(e){var t=a.call(null,this._value,e);return this._value=[e].reduce(function(e,r,n,o){return e-t*r},this._value*t)/t,this},multiply:function(e){return this._value=[this._value,e].reduce(function(e,t,r,n){var o=a(e,t);return e*o*(t*o)/(o*o)},1),this},divide:function(e){return this._value=[this._value,e].reduce(function(e,t,r,n){var o=a(e,t);return e*o/(t*o)}),this},difference:function(e){return Math.abs(l(this._value).subtract(e).value())}},this.numeral=l},PivotLocale=function(e){this.LOCALE="",this.DEFAULT_LOCALE="en",this.setLocale(e||(navigator.language||"").substr(0,2)||(navigator.browserLanguage||this.DEFAULT_LOCALE).substring(0,2))};PivotLocale.prototype.LOCALES=[{ru:"Всего",en:"Total",de:"Summe",cs:"Celkem"},{ru:"Невозможно отобразить данные",en:"Unable to render data",de:"Daten können nicht rendern",cs:"Nebylo možné zobrazit data"},{ru:"Неправильные данные для отображения.",en:"Invalid data to display.",de:"Nicht korrekt Informationen angezeigt werden soll.",cs:"Nevhodná data k zobrazení"},{ru:"Возникла ошибка при получении данных с сервера.",en:"Error while trying to retrieve data from server.",de:"Beim Abrufen der Daten vom Server ist ein Fehler aufgetreten.",cs:"Chyba při pokusu o získání dat ze serveru"},{ru:"Нет данных для отображения.",en:"No data to display.",de:"Keine Daten zum anzeigen.",cs:"Žádná data k zobrazení"}],PivotLocale.prototype.setLocale=function(e){var t,r=[];if(e=e.toLowerCase(),this.LOCALES[0].hasOwnProperty(e))this.LOCALE=e;else{for(t in this.LOCALES[0])r.push(t);console.warn("LightPivot: locale "+e+" is not supported. Currently localized: "+r.join(", ")+"."),this.LOCALE="en"}},PivotLocale.prototype.get=function(e){return(this.LOCALES[e]||{})[this.LOCALE]||"{not localized: "+e+"}"};var pivotLocale=new PivotLocale,PivotView=function(e,t){if(!(t instanceof HTMLElement))throw new Error('Please, provide HTMLElement instance "container" into pivot table configuration.');this.tablesStack=[],this.selectedRows={},numeral.call(this),this.elements={container:t,base:document.createElement("div"),tableContainer:void 0,messageElement:void 0,searchSelect:void 0,searchInput:void 0},this.pagination=null,this.savedScroll={x:0,y:0},this.FIXED_COLUMN_SIZES=[],this.PAGINATION_BLOCK_HEIGHT=20,this.ANIMATION_TIMEOUT=500,this.SEARCH_ENABLED=!1,this.SEARCHBOX_LEFT_MARGIN=191,this.savedSearch={restore:!1,value:"",columnIndex:0},this.controller=e,this.SCROLLBAR_WIDTH=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var r=document.createElement("div");r.style.width="100%",e.appendChild(r);var n=r.offsetWidth;return e.parentNode.removeChild(e),t-n}(),this.init()};return PivotView.prototype.init=function(){var e=this,t=this.elements;t.base.className="lpt",t.base.setAttribute("LPTVersion",this.controller.VERSION),t.container.appendChild(t.base),this.pushTable(),this.displayLoading(),window.addEventListener("resize",function(){e.updateSizes.call(e)}),this._=function(){e.displayMessage('<a href="https://github.com/ZitRos/LightPivotTable">LIGHT PIVOT TABLE v'+e.controller.VERSION+'</a><br/>by <a href="https://plus.google.com/+NikitaSavchenko">Nikita Savchenko</a><br/>for dear users of products of <a href="http://www.intersystems.com/">InterSystems Corporation</a><br/>Hope you enjoy it!',!0)}},PivotView.prototype.getCellElement=function(e,t,r){var n,o,i,a,l=this.tablesStack[this.tablesStack.length-1].element,s=function(e,t,r){var n,o,i,a,l,s,c,u=[];for(c=0;c<e.rows.length;c++)for(n=e.rows[c],s=0;s<n.cells.length;s++){for(o=n.cells[s],i=s;u[c]&&u[c][i];++i);for(a=i;a<i+o.colSpan;++a)for(l=c;l<c+o.rowSpan;++l)u[l]||(u[l]=[]),u[l][a]=!0;if(i<=t&&t<i+o.colSpan&&c<=r&&r<c+o.rowSpan)return o}return null};if(r){if(!(n=l.getElementsByClassName("lpt-topHeader")[0]))return null;if(!(n=n.getElementsByTagName("table")[0]))return null;if(o=0,[].slice.call(n.rows).forEach(function(e){o+=e.rowSpan||1}),a=l.getElementsByClassName("lpt-leftHeader")[0],!n)return null;if(a=a.getElementsByTagName("table")[0],!n)return null;if(i=0,(this.getCurrentTableData().element||{})._listing||[].slice.call((a.rows[0]||{cells:[]}).cells).forEach(function(e){i+=e.colSpan||1}),e<i&&t<o)return l.getElementsByClassName("lpt-headerValue")[0]||null;if(e>=i&&t<o)return(s(n,e-i,t)||{childNodes:[null]}).childNodes[0];if(e<i&&t>=o)return(s(a,e,t-o)||{childNodes:[null]}).childNodes[0];e-=i,t-=o}return(n=l.getElementsByClassName("lpt-tableBlock")[0])?(n=n.getElementsByTagName("table")[0])?((n.rows[t]||{cells:[]}).cells[e]||{childNodes:[null]}).childNodes[0]:null:null},PivotView.prototype.getTableSize=function(e){var t,r=0,n=0,o=this.tablesStack[this.tablesStack.length-1].element;return(t=o.getElementsByClassName("lpt-tableBlock")[0])&&(t=t.getElementsByTagName("table")[0])?([].slice.call(t.rows).forEach(function(e){n+=e.rowSpan||1}),[].slice.call((t.rows[0]||{cells:[]}).cells).forEach(function(e){r+=e.colSpan||1}),e?(t=o.getElementsByClassName("lpt-topHeader")[0])&&(t=t.getElementsByTagName("table")[0])?([].slice.call(t.rows).forEach(function(e){n+=e.rowSpan||1}),(t=o.getElementsByClassName("lpt-leftHeader")[0])&&(t=t.getElementsByTagName("table")[0])?((this.getCurrentTableData().element||{})._listing||[].slice.call((t.rows[0]||{cells:[]}).cells).forEach(function(e){r+=e.colSpan||1}),{width:r,height:n}):0):0:{width:r,height:n}):0},PivotView.prototype.displayLoading=function(){this.displayMessage(this.controller.CONFIG.loadingMessageHTML||'<div class="lpt-spinner"><div></div><div></div><div></div><div></div><div></div></div>')},PivotView.prototype.updateSizes=function(){for(var e in this.tablesStack)this.recalculateSizes(this.tablesStack[e].element)},PivotView.prototype._updateTablesPosition=function(e){for(var t=0;t<this.tablesStack.length;t++)this.tablesStack[t].element.style.left=100*(1+(e||0)+t-this.tablesStack.length)+"%"},PivotView.prototype.getCurrentTableData=function(){return this.tablesStack[this.tablesStack.length-1]},PivotView.prototype.pushTable=function(e){var t,r=this,n=document.createElement("div");n.className="tableContainer",this.tablesStack.length&&(this.tablesStack[this.tablesStack.length-1].FIXED_COLUMN_SIZES=this.FIXED_COLUMN_SIZES,this.tablesStack[this.tablesStack.length-1].savedSearch=this.savedSearch,this.tablesStack[this.tablesStack.length-1].selectedRows=this.selectedRows,this.savedSearch={restore:!1,value:"",columnIndex:0},n.style.left="100%"),this.tablesStack.push({element:n,opts:e||{},pagination:t={on:!1,rows:1/0,page:0,pages:0}}),this.FIXED_COLUMN_SIZES=[],this.selectedRows={},this.elements.base.appendChild(n),this.elements.tableContainer=n,this.pagination=t,setTimeout(function(){r._updateTablesPosition()},30)},PivotView.prototype.popTable=function(){var e;if(!(this.tablesStack.length<2)){this.FIXED_COLUMN_SIZES=[],this._updateTablesPosition(1);var t=this.tablesStack.pop();this.pagination=(e=this.tablesStack[this.tablesStack.length-1]).pagination,e.FIXED_COLUMN_SIZES&&(this.FIXED_COLUMN_SIZES=e.FIXED_COLUMN_SIZES),e.savedSearch&&(this.savedSearch=e.savedSearch),e.selectedRows&&(this.selectedRows=e.selectedRows),setTimeout(function(){t.element.parentNode.removeChild(t.element)},this.ANIMATION_TIMEOUT),this.elements.tableContainer=this.tablesStack[this.tablesStack.length-1].element}},PivotView.prototype.saveScrollPosition=function(){var e;this.elements.tableContainer&&(e=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(this.savedScroll.x=e[0].scrollLeft,this.savedScroll.y=e[0].scrollTop)},PivotView.prototype.restoreScrollPosition=function(){var e;this.elements.tableContainer&&(e=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(e[0].scrollLeft=this.savedScroll.x,e[0].scrollTop=this.savedScroll.y)},PivotView.prototype.dataChanged=function(e){var t=e.rawData.length-e.info.topHeaderRowsNumber;this.controller.CONFIG.pagination&&(this.pagination.on=!0),this.pagination.rows=this.controller.CONFIG.pagination||1/0,this.selectedRows={},this.pagination.page=0,this.pagination.pages=Math.ceil(t/this.pagination.rows),this.pagination.pages<2&&(this.pagination.on=!1),this.renderRawData(e)},PivotView.prototype._columnClickHandler=function(e){this.saveScrollPosition(),this.controller.dataController.sortByColumn(e),this.restoreScrollPosition()},PivotView.prototype._rowClickHandler=function(e,t){var r=!0;if("function"==typeof this.controller.CONFIG.triggers.rowClick){var n=this.controller.getRowsValues([e])[0].slice(this.controller.dataController.getData().info.leftHeaderColumnsNumber);r=this.controller.CONFIG.triggers.rowClick(e,n)}!1!==r&&this.controller.tryDrillDown(t.source.path)},PivotView.prototype._pageSwitcherHandler=function(e){this.pagination.page=e,this.saveScrollPosition(),this.renderRawData(this.controller.dataController.getData()),this.restoreScrollPosition()},PivotView.prototype._backClickHandler=function(e){e&&(e.cancelBubble=!0,e.stopPropagation()),this.removeMessage(),this.popTable(),this.controller.popDataSource(),"function"==typeof this.controller.CONFIG.triggers.back&&this.controller.CONFIG.triggers.back.call(this.controller,{level:this.controller.DRILL_LEVEL})},PivotView.prototype._drillThroughClickHandler=function(e){this.controller.tryDrillThrough(),e&&(e.cancelBubble=!0,e.stopPropagation())},PivotView.prototype._getSelectedText=function(){var e="";return void 0!==window.getSelection?e=window.getSelection().toString():void 0!==document.selection&&"Text"==document.selection.type&&(e=document.selection.createRange().text),e},PivotView.prototype._cellClickHandler=function(e,t,r,n,o){var i,a,l=this.controller.dataController.getData(),s=[],c=!0,u=this.controller.CONFIG.showSummary&&this.controller.CONFIG.attachTotals?1:0;if(!this._getSelectedText()&&("function"!=typeof this.controller.CONFIG.triggers.cellSelected||!1!==this.controller.CONFIG.triggers.cellSelected.call(this.controller,{x:t-l.info.leftHeaderColumnsNumber,y:r-l.info.topHeaderRowsNumber,leftHeaderColumnsNumber:l.info.leftHeaderColumnsNumber,topHeaderRowsNumber:l.info.topHeaderRowsNumber}))){try{i=l.rawData[r][l.info.leftHeaderColumnsNumber-1].source.path,a=l.rawData[l.info.topHeaderRowsNumber-1-u][t].source.path}catch(h){this.controller.CONFIG.logs&&console.warn("Unable to get filters for cell (%d, %d)",t,r)}i&&s.push(i),a&&s.push(a),this.controller.CONFIG.drillDownTarget?window.location=location.origin+location.pathname+"?DASHBOARD="+encodeURIComponent(this.controller.CONFIG.drillDownTarget)+"&SETTINGS=FILTER:"+encodeURIComponent(s.join("~"))+";":("function"==typeof this.controller.CONFIG.triggers.cellDrillThrough&&(c=this.controller.CONFIG.triggers.cellDrillThrough({event:n,filters:s,cellData:e,x:t,y:r},l)),"function"==typeof o&&(c=!(!1===o({event:n,filters:s,cellData:e,x:t,y:r},l)||!1===c)),!1!==c&&this.controller.tryDrillThrough(s))}},PivotView.prototype.copyToClipboard=function(e){var t=document.createElement("input");document.body.appendChild(t),t.setAttribute("value",e),document.body.appendChild(t),t.select();var r=!1;try{r=document.execCommand("copy")}catch(o){console.log("Copy error: "+o)}return document.body.removeChild(t),r},PivotView.prototype.listingClickHandler=function(e,t){if(0===t.info.leftHeaderColumnsNumber){var r=this.controller.CONFIG.triggerEvent||"click",n=this,o=function(e){return document.createElement(e)},i=o("div"),a=t.rawData[0].map(function(e){return e.value+(e.source&&e.source.title?"("+e.source.title+")":"")}),l=t.rawData[e.y].map(function(e){return e.value});i.className="lpt-hoverMessage",i.style.fontSize="12pt",i.style.opacity=0;for(var s,c,u,h,p,d=0;d<a.length;d++)s=o("div"),p=o("span"),c=o("div"),u=o("hr"),(h=o("div")).className="lpt-icon-copy",h.title="Copy",h.style.marginRight="6px",p.className="lpt-messageHead",p.textContent=a[d],c.className="lpt-messageBody",s.style.marginBottom=".3em",""!==l[d]?c.textContent=l[d]:c.innerHTML="&nbsp;",s.appendChild(h),s.appendChild(p),i.appendChild(s),i.appendChild(c),i.appendChild(u),h.addEventListener(r,function(e){return function(t){!1===n.copyToClipboard(e)&&alert("Your browser does not support dynamic content copying."),t.preventDefault(),t.cancelBubble=!0,t.preventBubble=!0}}(l[d]));return this.elements.base.appendChild(i),setTimeout(function(){i&&(i.style.opacity=1)},1),i.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){n._getSelectedText()||n.removeMessage()}),!1}console.warn("Listing handler called not for a listing!")},PivotView.prototype.displayMessage=function(e,t){this.removeMessage();var r=this,n=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div");n.className="central lpt-hoverMessage",n.style.opacity=0,i.innerHTML=e,o.appendChild(i),n.appendChild(o),this.elements.base.appendChild(n),setTimeout(function(){n&&(n.style.opacity=1)},1),t&&n.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){r.removeMessage()})},PivotView.prototype.removeMessage=function(){var e,t;if((e=this.elements.base.getElementsByClassName("lpt-hoverMessage")).length)for(t in e)e[t].parentNode&&e[t].parentNode.removeChild(e[t])},PivotView.prototype._matchCondition=function(e,t,r){var n=parseFloat(e);switch(t){case"=":return n==r;case"<>":return n!=r;case">":return n>r;case">=":return n>=r;case"<":return n<r;case"<=":return n<=r;case"IN":return-1!==r.toString().indexOf(n);case"BETWEEN":return n>=r.split(",")[0]&&n<=r.split(",")[1];case"IS NULL":return!n;default:return console.error('Formatting error: unknown format operator "'+t+'"'),!1}},PivotView.prototype.applyConditionalFormatting=function(e,t,r,n){var o,i,a,l,s,c,u=e[""]||[];for(o in u=u.concat(e[t]||[]),2===(s=t.split(",")).length&&(u=u.concat(e[s[0]]||[],e[s[0]+","]||[],e[","+s[1]]||[])),u)if(a=u[o],this._matchCondition(r,a.operator,a.value)){if(a.style&&n.setAttribute("style",(n.getAttribute("style")||"")+a.style),a.icon){for(n.textContent="",l='<div style="overflow: hidden; height: 16px;">',c=parseInt(a.iconCount)||1,i=0;i<c;i++)l+='<img alt="*" style="padding-right:2px; height: 100%;" src="'+a.icon+'"/>';n.innerHTML=l+"</div>"}a.text&&(n.textContent=a.text)}},PivotView.prototype.colorNameToRGB=function(e){var t=function(e,t,r){return{r:e,g:t,b:r}};switch(e){case"red":return t(255,0,0);case"green":return t(0,255,0);case"blue":return t(0,0,255);case"purple":return t(102,0,153);case"salmon":return t(255,140,105);case"white":return t(255,255,255);case"black":return t(0,0,0);case"gray":return t(128,128,128);default:return t(255,255,255)}},PivotView.prototype.selectRow=function(e,t){if(e?this.selectedRows[t]=1:delete this.selectedRows[t],"function"==typeof this.controller.CONFIG.triggers.rowSelect){var r=this.controller.getSelectedRows();this.controller.CONFIG.triggers.rowSelect(r,this.controller.getRowsValues(r))}},PivotView.prototype.recalculateSizes=function(e){var t=e.parentNode;try{var r=this,n=this.controller.CONFIG.triggerEvent||"click";if(!e.getElementsByClassName("lpt-headerValue")[0])return;var o=e.getElementsByClassName("lpt-header")[0],i=e.getElementsByClassName("lpt-topHeader")[0],a=e.getElementsByTagName("table")[0],l=a.offsetWidth,s=i.getElementsByTagName("thead")[0],c=e.getElementsByClassName("lpt-leftHeader")[0],u=c.getElementsByTagName("thead")[0],h=e.getElementsByClassName("lpt-tableBlock")[0],p=h.getElementsByTagName("table")[0],d=h.getElementsByTagName("tbody")[0],f=e.getElementsByClassName("lpt-searchInput")[0],m=f?e.offsetWidth-this.SEARCHBOX_LEFT_MARGIN:0,g=h.getElementsByTagName("tr")[0],v=e.getElementsByClassName("lpt-pageSwitcher")[0];s.childNodes[0]&&s.childNodes[0].lastChild._extraCell&&s.childNodes[0].removeChild(s.childNodes[0].lastChild),u.lastChild&&u.lastChild._extraTr&&u.removeChild(u.lastChild);var y=(v?this.PAGINATION_BLOCK_HEIGHT:0)+(this.SEARCH_ENABLED?this.PAGINATION_BLOCK_HEIGHT:0),C=Math.max(c.offsetWidth,o.offsetWidth),S=i.offsetHeight;i.style.marginLeft=C+"px";var N=e.offsetHeight,w=N-S-y,b=o.offsetWidth,O=0===u.offsetHeight,E=Math.max(u.offsetHeight,d.offsetHeight)>w&&this.SCROLLBAR_WIDTH>0,D=s.offsetWidth>i.offsetWidth-(E?this.SCROLLBAR_WIDTH:0);!E&&D&&(E=Math.max(u.offsetHeight,d.offsetHeight)>w-this.SCROLLBAR_WIDTH&&this.SCROLLBAR_WIDTH>0);var L,T,_,I=E&&!O,x=[],R=[],M=[],P=!1,F=function(){(r.controller.CONFIG.stretchColumns||!E||D)&&(P=!0,(T=document.createElement("th")).className="lpt-extraCell",T.style.minWidth=r.SCROLLBAR_WIDTH+"px",T.style.width=r.SCROLLBAR_WIDTH+"px",T.rowSpan=s.childNodes.length,T._extraCell=!0,s.childNodes[0].appendChild(T))};if(E&&s.childNodes[0]&&F(),e._primaryColumns)for(_ in e._primaryColumns)x.push(e._primaryColumns[_].offsetWidth);else console.warn("No _primaryColumns property in container, cell sizes won't be fixed.");if(e._primaryRows&&e._primaryCells){for(_ in e._primaryRows)R.push(e._primaryRows[_].offsetHeight);for(_ in e._primaryCells)M.push(e._primaryCells[_].offsetHeight)}else console.warn("No _primaryRows property in container, cell sizes won't be fixed.");var A=[].slice.call(c.getElementsByTagName("th")).map(function(e){return{el:e.getElementsByTagName("div")[0],height:e.getElementsByTagName("div")[0].offsetHeight}});if(e.parentNode.removeChild(e),i.style.marginLeft=C+"px",h.style.marginLeft=C+"px",c.style.height=N-S-y+"px",c.style.width=C+"px",b>C&&(c.style.width=b+"px"),h.style.height=N-S-y+"px",o.style.height=S+"px",o.style.width=C+"px",this.controller.CONFIG.stretchColumns||(a.style.width="auto",p.style.width=D?"100%":l+"px"),I&&((T=document.createElement("tr")).appendChild(L=document.createElement("th")),u.appendChild(T),L.__i=0,L.addEventListener(n,function(){L.__i++,L.style.background="#"+Math.max(18-3*L.__i,0).toString(16)+"FF7D7",L.__i>5&&r._()}),T._extraTr=!0,L.colSpan=u.childNodes.length,L.style.height=(this.SCROLLBAR_WIDTH?this.SCROLLBAR_WIDTH+1:0)+"px"),f&&(f.style.width=m+"px"),g)for(_ in g.childNodes)"TD"===g.childNodes[_].tagName&&(g.childNodes[_].style.width=x[_]+"px");e._primaryRows.forEach(function(t,r){e._primaryCells[r].style.height=e._primaryRows[r].style.height=Math.max(R[r]||R[r-1]||22,M[r]||M[r-1]||22)+"px"}),A.forEach(function(e){e.el.style.height=parseInt(e.height)+"px"}),t.appendChild(e),Math.max(u.offsetHeight,d.offsetHeight)>w&&this.SCROLLBAR_WIDTH>0&&!P&&F()}catch(H){console.error("Error when fixing sizes.","ERROR:",H)}},PivotView.prototype.getUnixDateFromCacheFormat=function(e){function t(e){var t=Date.parse(e);if(!isNaN(t))return t;if(2==e.split("-").length){var r=e.split("-"),n=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(r[0].toLowerCase());if(-1!=n)return Date.parse((n+1).toString()+"/01/"+r[1])}else if(2==e.split(" ").length){if(0===e.split(" ")[1].split(":").length&&(e+=":00"),t=Date.parse(e.replace(/-/g,"/")),!isNaN(t))return t}return 0}if(""===e&&void 0===e||null===e)return null;var r=e.toString();if(4==r.length)return t(e);if(-1!=r.indexOf("-"))return t(e);if(-1!=r.indexOf(" "))return t(e);if(6==r.length){var n=r.substr(0,4),o=r.substr(4,2);return Date.parse(new Date(parseInt(n),parseInt(o)-1,1))}if(5!=r.length||isNaN(parseInt(r)))return t(e);var i=new Date(1840,11,31),a=r.toString().split(","),l=parseInt(a[0]),s=null;return a.length>1&&(s=parseInt(a[1])),i=function(e,t){var r=new Date(e);return r.setDate(e.getDate()+t),r}(i,parseInt(l)),s&&i.setSeconds(s),Date.parse(i)},PivotView.prototype.renderRawData=function(e){if(e.rawData&&e.rawData[0]&&e.rawData[0][0]){var t,r,n,o,i,a,l,s,c,u=this,h=e.rawData,p=e.info,d=e.columnProps,f=e.rowProps,m=e.conditionalFormatting?e.conditionalFormatting.colorScale:void 0,g=this.controller.CONFIG.triggerEvent||"click",v=p.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,y=!!this.controller.CONFIG.columnResizing,C=0===p.leftHeaderColumnsNumber,S=C&&this.controller.CONFIG.enableSearch,N=this.controller.CONFIG.enableListingSelect,w=!!this.controller.CONFIG.columnResizeAnimation,b=this.elements.tableContainer,O=document.createElement("div"),E=document.createElement("div"),D=document.createElement("div"),L=document.createElement("div"),T=document.createElement("div"),_=document.createElement("div"),I=document.createElement("div"),x=document.createElement("table"),R=document.createElement("thead"),M=document.createElement("table"),P=document.createElement("thead"),F=document.createElement("table"),A=document.createElement("tbody"),H=this.pagination.on||C&&this.controller.CONFIG.showListingRowsNumber,k=H?document.createElement("div"):null,G=H?[]:null,B=k?document.createElement("div"):null,U=S?document.createElement("div"):null,V=S?document.createElement("span"):null,W=S?document.createElement("select"):null,X=S?document.createElement("span"):null,z=S?document.createElement("input"):null,j=S?function(){for(var e=[],t=p.leftHeaderColumnsNumber,r=p.topHeaderRowsNumber-1-v,n=t;n<h[r].length;n++)e.push({value:h[r][n].value,source:h[r][n].source,columnIndex:n});return e}():null,Y={},$=null,Z=[],J=[],K=[];this.SEARCH_ENABLED=S,this.numeral.setup(p.decimalSeparator||".",p.numericGroupSeparator||",",p.numericGroupSize||3);var q=function(e,t,r){if("string"==typeof e)("%"!==e[e.length-1]||isNaN(parseFloat(e)))&&(t.parentNode.className+=" formatLeft"),t.innerHTML=(e||"").replace(/(https?|ftp):\/\/[^\s]+/gi,function(e){return"<a href='"+e+"' target='"+(u.controller.CONFIG.linksTarget||"_blank")+"' onclick='var e=event||window.event;e.stopPropagation();e.cancelBubble=true;'>"+e+"</a>"});else if(C)t.textContent=e;else if("%date%"===r){var n=new Date(u.getUnixDateFromCacheFormat(e));if(isNaN(n.getTime()))return void(t.textContent=e);t.textContent=n.getHours()+n.getMinutes()+n.getSeconds()===0?n.toLocaleDateString():n.toLocaleString()}else t.textContent=r?e?u.numeral(e).format(r):e:e?u.numeral(e).format(e%1==0?"#,###":"#,###.##"):e},Q=function(e,t){var r=0,n=0,o=function(t){t.cancelBubble=!0,t.preventDefault(),e.style.width=e.style.minWidth=r-n+t.pageX+"px",w&&(u.saveScrollPosition(),u.recalculateSizes(b),u.restoreScrollPosition())},i=function(a){a.cancelBubble=!0,a.preventDefault(),e.style.width=e.style.minWidth=(u.FIXED_COLUMN_SIZES[t]=r-n+a.pageX)+"px",u.saveScrollPosition(),u.recalculateSizes(b),u.restoreScrollPosition(),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",i)};e.addEventListener("mousedown",function(t){(t.target||t.srcElement)===e&&(t.cancelBubble=!0,t.preventDefault(),r=e.offsetWidth,n=t.pageX,document.addEventListener("mousemove",o),document.addEventListener("mouseup",i))})};for(this.removeMessage();b.firstChild;)b.removeChild(b.firstChild);var ee=function(e,t,o,i,a){function l(e){for(var t=e.checked;e=e.parentNode;)if("TR"===e.tagName){e.classList[t?"add":"remove"]("lpt-selectedRow"),u.elements.tableContainer.querySelector(".lpt-tableBlock table").rows[e.rowIndex].classList[t?"add":"remove"]("lpt-selectedRow");break}}var s,c,m,C,S,w,b=a===P;if(e===t&&N)for(n=o;n<i;n++)m=document.createElement("tr"),C=document.createElement("td"),(w=document.createElement("input")).setAttribute("type","checkbox"),w.checked=!!u.selectedRows[n],w.checked&&function(e){setTimeout(function(){l(e)},1)}(w),C.setAttribute("style","padding: 0 !important;"),w.addEventListener("click",function(e){return function(t){var r=t.srcElement||t.target;t.preventDefault(),t.cancelBubble=!0,setTimeout(function(){r.checked=!r.checked,u.selectRow.call(u,r.checked,e),l(r)},1)}}(n)),C.appendChild(w),m.appendChild(C),J.push(C),a.appendChild(m);else for(n=o;n<i;n++){for(r=e;r<t;r++)c=!0,(s=Y.hasOwnProperty(h[n][r].group))&&(r>0&&h[n][r-1].group===h[n][r].group&&(c=!1,Y[h[n][r].group].element.colSpan=r-Y[h[n][r].group].x+1),n>0&&h[n-1][r].group===h[n][r].group&&(c=!1,Y[h[n][r].group].element.rowSpan=n-Y[h[n][r].group].y+1),C=Y[h[n][r].group].element),s&&!c||(m||(m=document.createElement("tr")),m.appendChild(C=document.createElement(h[n][r].isCaption?"th":"td")),h[n][r].source&&h[n][r].source.title&&C.setAttribute("title",h[n][r].source.title),S=document.createElement("div"),h[n][r].value?S.textContent=h[n][r].value:S.innerHTML="&nbsp;",C.appendChild(S),h[n][r].style&&C.setAttribute("style",h[n][r].style),0===p.leftHeaderColumnsNumber&&u.controller.CONFIG.listingColumnMinWidth&&(C.style.minWidth=u.controller.CONFIG.listingColumnMinWidth+"px"),p.leftHeaderColumnsNumber>0&&u.controller.CONFIG.maxHeaderWidth&&(C.style.maxWidth=u.controller.CONFIG.maxHeaderWidth+"px",C.style.whiteSpace="normal",C.style.wordWrap="normal"),h[n][r].className&&(C.className=h[n][r].className),h[n][r].group&&(Y[h[n][r].group]={x:r,y:n,element:C}),h[n][r].isCaption||q(h[n][r].value,C,f[n].format||d[r].format)),b&&r===t-1&&(J.push(C),C.addEventListener(g,function(e,t){return function(){u._rowClickHandler.call(u,e,t)}}(n,h[n][r]))),b||n!==i-1-v||C._hasSortingListener||(C._hasSortingListener=!1,h[n][r].noClick||C.addEventListener(g,function(e){return function(){u._columnClickHandler.call(u,e)}}(r-p.leftHeaderColumnsNumber)),C.className=(C.className||"")+" lpt-clickable"),b||n!==i-1||(u.FIXED_COLUMN_SIZES[r]&&(C.style.minWidth=C.style.width=u.FIXED_COLUMN_SIZES[r]+"px"),y&&(Q(C,r),C.className+=" lpt-resizableColumn"),Z.push(C));m&&a.appendChild(m),m=null}};for(T.textContent=p.leftHeaderColumnsNumber?h[0][0].value:"",h[0][0].style&&!C&&T.setAttribute("style",h[0][0].style),this.tablesStack.length>1&&!this.controller.CONFIG.hideButtons&&(T.className+="back ",T.addEventListener(g,function(e){u._backClickHandler.call(u,e)})),p.leftHeaderColumnsNumber>0&&u.controller.CONFIG.maxHeaderWidth&&(D.style.maxWidth=u.controller.CONFIG.maxHeaderWidth*p.leftHeaderColumnsNumber+"px",D.style.whiteSpace="normal",D.style.wordWrap="normal"),(this.controller.CONFIG.hideButtons||this.tablesStack.length<2)&&0===p.leftHeaderColumnsNumber&&(T.style.display="none"),ee(p.leftHeaderColumnsNumber,h[0].length,0,p.topHeaderRowsNumber,R),ee(0,p.leftHeaderColumnsNumber,l=p.topHeaderRowsNumber+(this.pagination.page*this.pagination.rows||0),s=this.pagination.on?Math.min(l+this.pagination.rows,h.length):h.length,P),n=l;n<s;n++){for($=document.createElement("tr"),r=p.leftHeaderColumnsNumber;r<h[0].length;r++)a=this.controller.getPivotProperty(["cellStyle"])||"",$.appendChild(o=document.createElement("td")),o.appendChild(c=document.createElement("div")),r===p.leftHeaderColumnsNumber&&K.push(o),q(h[n][r].value,c,d[r]&&d[r].format||f[n]&&f[n].format),!m||p.SUMMARY_SHOWN&&h.length-1===n||(i=(parseFloat(h[n][r].value)-m.min)/m.diff,a+="background:rgb("+ +Math.round((m.to.r-m.from.r)*i+m.from.r)+","+Math.round((m.to.g-m.from.g)*i+m.from.g)+","+Math.round((m.to.b-m.from.b)*i+m.from.b)+");"+(m.invert?"color: white;":"")),(d[r].style||f[n]&&f[n].style)&&(a+=(f[n]&&f[n].style||"")+(f[n]&&f[n].style?" ":"")+(d[r].style||"")),h[n][r].style&&(a+=h[n][r].style),!this.controller.CONFIG.conditionalFormattingOn||p.SUMMARY_SHOWN&&h.length-1===n||this.getCurrentTableData().opts.disableConditionalFormatting||this.applyConditionalFormatting(e.conditionalFormatting,n-p.topHeaderRowsNumber+1+","+(r-p.leftHeaderColumnsNumber+1),h[n][r].value,o),a&&o.setAttribute("style",(o.getAttribute("style")||"")+a),o.addEventListener(g,function(e,t,r){return function(n){u._cellClickHandler.call(u,r,e,t,n,p.drillThroughHandler)}}(r,n,h[n][r]));A.appendChild($)}if(I.addEventListener("scroll",function(){return I._ISE?void(I._ISE=!1):(L.scrollLeft=I.scrollLeft,_.scrollTop=I.scrollTop,L._ISE=!0,void(_._ISE=!0))}),_.className="lpt-leftHeader",L.className="lpt-topHeader",this.controller.CONFIG.enableHeadersScrolling&&(_.className=_.className+" lpt-scrollable-y",L.className=L.className+" lpt-scrollable-x",_.addEventListener("scroll",function(){return _._ISE?void(_._ISE=!1):(I.scrollTop=_.scrollTop,void(I._ISE=!0))}),L.addEventListener("scroll",function(){return L._ISE?void(L._ISE=!1):(I.scrollLeft=L.scrollLeft,void(I._ISE=!0))})),I.className="lpt-tableBlock",D.className="lpt-header",O.className="lpt-topSection",E.className="lpt-bottomSection",T.className+="lpt-headerValue",F.appendChild(A),I.appendChild(F),M.appendChild(P),_.appendChild(M),x.appendChild(R),L.appendChild(x),D.appendChild(T),O.appendChild(D),O.appendChild(L),E.appendChild(_),E.appendChild(I),b.appendChild(O),b.appendChild(E),this.controller.CONFIG.stretchColumns||(x.style.width="auto"),k){for(t in k.className="lpt-pageSwitcher",G=function(e,t){for(var r=0,n=[e];e>1;)e=Math.max(1,e-(r||1)),n.unshift(e),r=r*r+1;for(r=0,e=n[n.length-1];e<t;)e=Math.min(t,e+(r||1)),n.push(e),r=r*r+1;return n}(this.pagination.page+1,this.pagination.pages),this.controller.CONFIG.showListingRowsNumber&&(o=document.createElement("div"),($=document.createElement("span")).className="lpt-icon-rows",o.className="lpt-bottomInfo",o.appendChild($),($=document.createElement("span")).textContent=e.rawData.length-(e.info.topHeaderRowsNumber||0)-(e.info.SUMMARY_SHOWN?1:0),o.appendChild($),B.appendChild(o)),G)t=parseInt(t),o=document.createElement("span"),G[t]===this.pagination.page+1&&(o.className="lpt-active"),o.textContent=G[t],function(e){o.addEventListener(g,function(){u._pageSwitcherHandler.call(u,e-1)})}(G[t]),B.appendChild(o),G[t+1]&&G[t]+1!==G[t+1]&&((o=document.createElement("span")).className="lpt-pageSpacer",B.appendChild(o));k.appendChild(B),b.appendChild(k)}if(S){for(t in V.className="lpt-searchIcon",X.className="lpt-searchSelectOuter",U.className="lpt-searchBlock",z.className="lpt-searchInput",W.className="lpt-searchSelect",j)(o=document.createElement("option")).setAttribute("value",j[t].columnIndex.toString()),o.textContent=j[t].value,W.appendChild(o);z.addEventListener("input",function(){var e=parseInt(W.options[W.selectedIndex].value),t=z.value;u.saveScrollPosition(),u.savedSearch.value=t,u.savedSearch.columnIndex=e,u.savedSearch.restore=!0,u.controller.dataController.filterByValue(t,e),u.restoreScrollPosition()}),U.appendChild(V),X.appendChild(W),U.appendChild(X),U.appendChild(z),b.insertBefore(U,O),this.elements.searchInput=z,this.elements.searchSelect=W,this.savedSearch.restore&&(this.elements.searchInput.value=this.savedSearch.value,this.elements.searchSelect.value=this.savedSearch.columnIndex)}else this.elements.searchInput=void 0,this.elements.searchSelect=void 0;b._primaryColumns=Z,b._primaryRows=J,b._primaryCells=K,b._listing=C,this.recalculateSizes(b),this.savedSearch.restore&&(this.elements.searchInput.focus(),function(e,t){var r;e.createTextRange?((r=e.createTextRange()).move("character",t),r.select()):e.setSelectionRange(t,t)}(this.elements.searchInput,this.savedSearch.value.length)),"function"==typeof this.controller.CONFIG.triggers.contentRendered&&this.controller.CONFIG.triggers.contentRendered(this.controller)}else this.displayMessage("<h1>"+pivotLocale.get(1)+"</h1><p>"+JSON.stringify(e)+"</p>")},LightPivotTable}();